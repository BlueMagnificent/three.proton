/*!
 * Proton v1.0.0
 * https://github.com/a-jie/Proton
 *
 * Copyright 2011-2016, A-JIE
 * Licensed under the MIT license
 * http://www.opensource.org/licenses/mit-license
 *
 */
(function(a,b){function be(a,b,c,d){be._super_.call(this),this.camera=a,this.renderer=b,this.dis=c||20,d=d||"1234";for(var e=1;e<5;e++)this["d"+e]=d.indexOf(e+"")>=0;this.name="ScreenZone"}function bd(a,b,d,e,f,g){var h,i,j,k,l,e;bd._super_.call(this),c.Util.isUndefined(b,d,e,f,g)?(h=i=j=0,k=l=e=a||100):c.Util.isUndefined(e,f,g)?(h=i=j=0,k=a,l=b,e=d):(h=a,i=b,j=d,k=e,l=f,e=g),this.x=h,this.y=i,this.z=j,this.width=k,this.height=l,this.depth=e,this.friction=.85,this.max=6}function bc(a,b,d){var e,f,g;bc._super_.call(this),c.Util.isUndefined(a,b,d)?e=f=g=0:(e=a,f=b,g=d),this.x=e,this.y=e,this.z=e}function bb(a,b){bb._super_.call(this),a instanceof THREE.Geometry?this.geometry=a:this.geometry=a.geometry,this.scale=b||1}function ba(a,b,d,e){var f,g,h,i;ba._super_.call(this),c.Util.isUndefined(b,d,e)?(f=g=h=0,i=a||100):(f=a,g=b,h=d,i=e),this.x=f,this.y=f,this.z=f,this.radius=i,this.the=this.phi=0}function _(a,b,d,e,f,g){_._super_.call(this),a instanceof c.Vector3D?(this.x1=a.x,this.y1=a.y,this.z1=a.z,this.x2=e.x,this.y2=e.y,this.z2=e.z):(this.x1=a,this.y1=b,this.z1=d,this.x2=e,this.y2=f,this.z2=g)}function $(){this.vector=new c.Vector3D(0,0,0),this.random=0,this.crossType="dead",this.log=!0}function Z(){Z._super_.call(this),this.targetPool=new c.Pool,this.materialPool=new c.Pool,this.name="CustomRender"}function Y(a){Y._super_.call(this,a),this._body=new THREE.Sprite(new THREE.SpriteMaterial({color:16777215})),this.name="SpriteRender"}function X(a){X._super_.call(this),this.points=a,this.name="PointsRender"}function W(a){W._super_.call(this),this.container=a,this._targetPool=new c.Pool,this._materialPool=new c.Pool,this._body=new THREE.Mesh(new THREE.BoxGeometry(50,50,50),new THREE.MeshLambertMaterial({color:"#ff0000"})),this.name="MeshRender"}function V(){this.name="BaseRender"}function S(b,d,e){this.mouseTarget=c.Util.initValue(b,a),this.ease=c.Util.initValue(d,.7),this._allowEmitting=!1,this.initEventHandler(),S._super_.call(this,e)}function R(a){this.selfBehaviours=[],R._super_.call(this,a)}function Q(a){this.initializes=[],this.particles=[],this.behaviours=[],this.currentEmitTime=0,this.totalEmitTimes=-1,this.damping=.006,this.bindEmitter=!0,this.rate=new c.Rate(1,.1),Q._super_.call(this,a),this.id="emitter_"+Q.ID++,this.cID=0,this.name="Emitter"}function P(a,b,c,d,e,f,g){P._super_.call(this,f,g),P.prototype.reset(a,b,c,d,e),this.name="Spring"}function O(a,b,c,d){O._super_.call(this,c,d),this.reset(a,b),this.name="Color"}function N(a,b,c,d,e){N._super_.call(this,d,e),this.reset(a,b,c),this.name="Rotate"}function M(a,b,c,d){M._super_.call(this,c,d),this.reset(a,b),this.name="Scale"}function L(a,b,c,d){L._super_.call(this,c,d),this.reset(a,b),this.name="Alpha"}function K(a,b,c,d){K._super_.call(this,c,d),this.reset(a,b),this.name="CrossZone"}function J(a,b,c,d,e){J._super_.call(this,d,e),this.reset(a,b,c),this.name="Collision"}function I(a,b,c){I._super_.call(this,0,-a,0,b,c),this.name="Gravity"}function H(a,b,c,d,e){H._super_.call(this,a,b,c,d,e),this.force*=-1,this.name="Repulsion"}function G(a,b,c,d,e,f){G._super_.call(this,e,f),this.reset(a,b,c,d),this.time=0,this.name="RandomDrift"}function F(a,b,d,e,f){F._super_.call(this,e,f),this.targetPosition=c.Util.initValue(a,new c.Vector3D),this.radius=c.Util.initValue(d,1e3),this.force=c.Util.initValue(this.normalizeValue(b),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new c.Vector3D,this.lengthSq=0,this.name="Attraction"}function E(a,b,c,d,e){E._super_.call(this,d,e),E.prototype.reset.call(this,a,b,c),this.name="Force"}function D(a,b,d){D._super_.call(this),this.body=c.createArraySpan(a),this.w=b,this.h=c.Util.initValue(d,this.w)}function C(a,b,d){C._super_.call(this),this.radius=c.createSpan(a,b,d)}function B(a,b,d){B._super_.call(this),this.massPan=c.createSpan(a,b,d)}function A(a,b,d){A._super_.call(this),this.reset(a,b,d),this.dirVec=new c.Vector3D(0,0,0),this.name="Velocity"}function z(){z._super_.call(this),this.reset.apply(this,arguments)}function y(a,b,d){y._super_.call(this),this.lifePan=c.createSpan(a,b,d)}function w(){this.name="Initialize"}function v(a,b){this.numPan=c.createSpan(c.Util.initValue(a,1)),this.timePan=c.createSpan(c.Util.initValue(b,1)),this.startTime=0,this.nextTime=0,this.init()}function u(a,b){this.id="Behaviour_"+u.id++,this.life=c.Util.initValue(a,Infinity),this.easing=c.Util.initValue(b,c.ease.setEasingByName(c.ease.easeLinear)),this.age=0,this.energy=1,this.dead=!1,this.name="Behaviour"}function t(a,b,c,d,e,f){this.x=a,this.y=b,this.z=c,this.width=d,this.height=e,this.depth=f,this.bottom=this.y+this.height,this.right=this.x+this.width,this.right=this.x+this.width}function r(a){this._arr=c.Util.isArray(a)?a:[a]}function q(a,b,d){this._isArray=!1,c.Util.isArray(a)?(this._isArray=!0,this.a=a):(this.a=c.Util.initValue(a,1),this.b=c.Util.initValue(b,this.a),this._center=c.Util.initValue(d,!1))}function k(){this.cID=0,this.list={}}function j(a){this.id="particle_"+j.ID++,this.name="Particle",this.reset("init"),c.Util.setPrototypeByObj(this,a)}function d(){this.initialize()}function c(a,b){this.preParticles=c.Util.initValue(a,c.POOL_MAX),this.integrationType=c.Util.initValue(b,c.EULER),this.emitters=[],this.renderers=[],this.pool=new c.Pool,c.integrator=new c.Integration(this.integrationType)}c.POOL_MAX=500,c.TIME_STEP=60,c.PI=3.142,c.DR=c.PI/180,c.MEASURE=100,c.EULER="euler",c.RK2="runge-kutta2",c.RK4="runge-kutta4",c.VERLET="verlet",c.PARTICLE_CREATED="partilcleCreated",c.PARTICLE_UPDATE="partilcleUpdate",c.PARTICLE_SLEEP="particleSleep",c.PARTICLE_DEAD="partilcleDead",c.PROTON_UPDATE="protonUpdate",c.PROTON_UPDATE_AFTER="protonUpdateAfter",c.EMITTER_ADDED="emitterAdded",c.EMITTER_REMOVED="emitterRemoved",c.bindEmtterEvent=!1,c.prototype={addRender:function(a){this.renderers.push(a),a.init(this)},removeRender:function(a){this.renderers.splice(this.renderers.indexOf(a),1),a.remove(this)},addEmitter:function(a){this.emitters.push(a),a.parent=this,this.dispatchEvent("EMITTER_ADDED",a)},removeEmitter:function(a){a.parent==this&&(this.emitters.splice(this.emitters.indexOf(a),1),a.parent=null,this.dispatchEvent("EMITTER_REMOVED",a))},update:function(a){this.dispatchEvent("PROTON_UPDATE",this);var b=a||.0167;if(b>0){var c=this.emitters.length;while(c--)this.emitters[c].update(b)}this.dispatchEvent("PROTON_UPDATE_AFTER",this)},getCount:function(){var a=0,b,c=this.emitters.length;for(b=0;b<c;b++)a+=this.emitters[b].particles.length;return a},destroy:function(){var a=0,b=this.emitters.length;for(a;a<b;a++)this.emitters[a].destroy(),delete this.emitters[a];this.emitters.length=0,this.particlePool.destroy()}},a.Proton=c,d.initialize=function(a){a.addEventListener=e.addEventListener,a.removeEventListener=e.removeEventListener,a.removeAllEventListeners=e.removeAllEventListeners,a.hasEventListener=e.hasEventListener,a.dispatchEvent=e.dispatchEvent};var e=d.prototype;e._listeners=null,e.initialize=function(){},e.addEventListener=function(a,b){this._listeners?this.removeEventListener(a,b):this._listeners={},this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push(b);return b},e.removeEventListener=function(a,b){if(!!this._listeners){if(!this._listeners[a])return;var c=this._listeners[a];for(var d=0,e=c.length;d<e;d++)if(c[d]==b){e==1?delete this._listeners[a]:c.splice(d,1);break}}},e.removeAllEventListeners=function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},e.dispatchEvent=function(a,b){var c=!1,d=this._listeners;if(a&&d){var e=d[a];if(!e)return c;e=e.slice();var f,g=e.length;while(g--){var f=e[g];c=c||f(b)}}return!!c},e.hasEventListener=function(a){var b=this._listeners;return!!b&&!!b[a]},d.initialize(c.prototype),c.EventDispatcher=d;var f=f||{initValue:function(a,c){var a=a!=null&&a!=b?a:c;return a},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},destroyArray:function(a){a.length=0},destroyObject:function(a){for(var b in a)delete a[b]},isUndefined:function(){for(var a in arguments){var c=arguments[a];if(c!==b)return!1}return!0},setVectorByObj:function(a,c){c.x!==b&&(a.p.x=c.x),c.y!==b&&(a.p.y=c.y),c.z!==b&&(a.p.z=c.z),c.vx!==b&&(a.v.x=c.vx),c.vy!==b&&(a.v.y=c.vy),c.vz!==b&&(a.v.z=c.vz),c.ax!==b&&(a.a.x=c.ax),c.ay!==b&&(a.a.y=c.ay),c.az!==b&&(a.a.z=c.az),c.p!==b&&a.p.copy(c.p),c.v!==b&&a.v.copy(c.v),c.a!==b&&a.a.copy(c.a),c.position!==b&&a.p.copy(c.position),c.velocity!==b&&a.v.copy(c.velocity),c.accelerate!==b&&a.a.copy(c.accelerate)},setPrototypeByObj:function(a,b,c){for(var d in b)a.hasOwnProperty(d)&&(c?c.indexOf(d)<0&&(a[d]=f._getValue(b[d])):a[d]=f._getValue(b[d]));return a},_getValue:function(a){return a instanceof q?a.getValue():a},inherits:function(a,b){a._super_=b;if(Object.create)a.prototype=Object.create(b.prototype,{constructor:{value:a}});else{var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}}};c.Util=f;var g=g||{getRGB:function(a){var b={};if(typeof a=="number")d=Math.floor(a),b.r=(a>>16&255)/255,b.g=(a>>8&255)/255,b.b=(a&255)/255;else if(typeof a=="string"){var c;if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))b.r=Math.min(255,parseInt(c[1],10))/255,b.g=Math.min(255,parseInt(c[2],10))/255,b.b=Math.min(255,parseInt(c[3],10))/255;else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){var d=c[1];b.r=parseInt(d.charAt(0)+d.charAt(1),16)/255,b.g=parseInt(d.charAt(2)+d.charAt(3),16)/255,b.b=parseInt(d.charAt(4)+d.charAt(5),16)/255}}else a instanceof THREE.Color&&(b.r=a.r,b.g=a.g,b.b=a.b);return b}};c.ColorUtil=g;var h={toScreenPos:function(){var a=new THREE.Vector3;return function(b,c,d){a.copy(b),a.project(c),a.x=Math.round((a.x+1)*d.width/2),a.y=Math.round((-a.y+1)*d.height/2),a.z=0;return a}}(),toSpacePos:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c;return function(d,e,f){a.set(d.x/f.width*2-1,-(d.y/f.height)*2+1,.5),a.unproject(e),b.copy(a.sub(e.position).normalize()),c=-e.position.z/b.z,a.copy(e.position),a.add(b.multiplyScalar(c));return a}}(),getTexture:function(){var a={};return function(b){if(b instanceof THREE.Texture)return b;if(typeof b=="string"){var d=c.PUID.hash(b);a[d]||(a[d]=new THREE.Texture(b));return a[d]}if(b instanceof Image){var d=c.PUID.hash(b.src);a[d]||(a[d]=new THREE.Texture(b));return a[d]}}}()};c.THREEUtil=h;var i=i||{_id:0,_uids:{},id:function(a){for(var b in this._uids)if(this._uids[b]==a)return b;var c="PUID_"+this._id++;this._uids[c]=a;return c},hash:function(a){return}};c.PUID=i,j.ID=0,j.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/c.PI)},reset:function(a){this.life=Infinity,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.body=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.useColor=!1,this.useAlpha=!1,this.easing=c.ease.setEasingByName(c.ease.easeLinear),a?(this.p=new c.Vector3D,this.v=new c.Vector3D,this.a=new c.Vector3D,this.old={},this.old.p=this.p.clone(),this.old.v=this.v.clone(),this.old.a=this.a.clone(),this.behaviours=[],this.transform={},this.color={r:0,g:0,b:0},this.rotation=new c.Vector3D):(this.p.set(0,0,0),this.v.set(0,0,0),this.a.set(0,0,0),this.old.p.set(0,0,0),this.old.v.set(0,0,0),this.old.a.set(0,0,0),this.color.r=0,this.color.g=0,this.color.b=0,this.rotation.clear(),c.Util.destroyObject(this.transform),this.removeAllBehaviours());return this},update:function(a,b){if(!this.sleep){this.age+=a;var c=this.behaviours.length;while(c--)this.behaviours[c]&&this.behaviours[c].applyBehaviour(this,a,b)}if(this.age>=this.life)this.destroy();else{var d=this.easing(this.age/this.life);this.energy=Math.max(1-d,0)}},addBehaviour:function(a){this.behaviours.push(a),a.initialize(this)},addBehaviours:function(a){var b=a.length;while(b--)this.addBehaviour(a[b])},removeBehaviour:function(a){var b=this.behaviours.indexOf(a);b>-1&&this.behaviours.splice(b,1)},removeAllBehaviours:function(){c.Util.destroyArray(this.behaviours)},destroy:function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}},c.Particle=j,k.prototype={create:function(a){this.cID++;return typeof a=="function"?new a:a.clone()},getCount:function(){var a=0;for(var b in this.list)a+=this.list[b].length;return a++},get:function(a){var b,d=a.__puid||c.PUID.id(a);this.list[d]&&this.list[d].length>0?b=this.list[d].pop():b=this.create(a),b.__puid=a.__puid||d;return b},expire:function(a){return this._getList(a.__puid).push(a)},destroy:function(){for(var a in this.list)this.list[a].length=0,delete this.list[a]},_getList:function(a){a=a||"default",this.list[a]||(this.list[a]=[]);return this.list[a]}},c.Pool=k;var l={randomAToB:function(a,b,c){return c?(Math.random()*(b-a)>>0)+a:a+Math.random()*(b-a)},randomFloating:function(a,b,c){return l.randomAToB(a-b,a+b,c)},randomZone:function(a){},degreeTransform:function(a){return a*c.PI/180},toColor16:function(a){return"#"+a.toString(16)},randomColor:function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6)},lerp:function(a,b,c){return b+(a-b)*c},getNormal:function(a,b){a.x==0&&a.y==0?a.z==0?b.set(1,0,1):b.set(1,1,-a.y/a.z):a.x==0?b.set(1,0,1):b.set(-a.y/a.x,1,1);return b.normalize()},axisRotate:function(a,b,c,d){var e=Math.cos(d),f=Math.sin(d),g=c.dot(b)*(1-e);a.copy(c),a.cross(b).scalar(f),a.addValue(b.x*e,b.y*e,b.z*e),a.addValue(c.x*g,c.y*g,c.z*g)}};c.MathUtils=l;var n=function(a){this.type=c.Util.initValue(a,c.EULER)};n.prototype={integrate:function(a,b,c){this.euler(a,b,c)},euler:function(a,b,c){a.sleep||(a.old.p.copy(a.p),a.old.v.copy(a.v),a.a.scalar(1/a.mass),a.v.add(a.a.scalar(b)),a.p.add(a.old.v.scalar(b)),c&&a.v.scalar(c),a.a.clear())}},c.Integration=n;var o=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};o.prototype={set:function(a,b,c){this.x=a,this.y=b,this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},getGradient:function(){if(this.x!=0)return Math.atan2(this.y,this.x);if(this.y>0)return c.PI/2;if(this.y<0)return-c.PI/2},copy:function(a){this.x=a.x,this.y=a.y,this.z=a.z;return this},add:function(a,c){if(c!==b)return this.addVectors(a,c);this.x+=a.x,this.y+=a.y,this.z+=a.z;return this},addValue:function(a,b,c){this.x+=a,this.y+=b,this.z+=c;return this},addVectors:function(a,b){this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z;return this},addScalar:function(a){this.x+=a,this.y+=a,this.z+=a;return this},sub:function(a,c){if(c!==b)return this.subVectors(a,c);this.x-=a.x,this.y-=a.y,this.z-=a.z;return this},subVectors:function(a,b){this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z;return this},scalar:function(a){this.x*=a,this.y*=a,this.z*=a;return this},divideScalar:function(a){a!==0?(this.x/=a,this.y/=a,this.z/=a):this.set(0,0,0);return this},negate:function(){return this.scalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x;return this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f;return this},eulerFromDir:function(a){},applyEuler:function(){var a;return function(d){a===b&&(a=new c.Quaternion),this.applyQuaternion(a.setFromEuler(d));return this}}(),applyAxisAngle:function(){var a;return function(d,e){a===b&&(a=new c.Quaternion),this.applyQuaternion(a.setFromAxisAngle(d,e));return this}}(),applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e;return this},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},lerp:function(a,b){this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},clear:function(){this.x=0,this.y=0,this.z=0;return this},clone:function(){return new c.Vector3D(this.x,this.y,this.z)},toString:function(){return"x:"+this.x+"y:"+this.y+"z:"+this.z}},c.Vector3D=o;var p=function(a,b,c){this.radius=a||1,this.phi=c||0,this.theta=b||0};p.prototype={set:function(a,b,c){this.radius=a||1,this.phi=c||0,this.theta=b||0;return this},setRadius:function(a){this.radius=a;return this},setPhi:function(a){this.phi=a;return this},setTheta:function(a){this.theta=a;return this},copy:function(a){this.radius=a.radius,this.phi=a.phi,this.theta=a.theta;return this},toVector3D:function(){return new c.Vector3D(this.getX(),this.getY(),this.getZ())},getX:function(){return this.radius*Math.sin(this.theta)*Math.cos(this.phi)},getY:function(){return-this.radius*Math.sin(this.theta)*Math.sin(this.phi)},getZ:function(){return this.radius*Math.cos(this.theta)},normalize:function(){this.radius=1;return this},equals:function(a){return a.radius===this.radius&&a.phi===this.phi&&a.theta===this.theta},clear:function(){this.radius=0,this.phi=0,this.theta=0;return this},clone:function(){return new p(this.radius,this.phi,this.theta)}},c.Polar3D=p,q.prototype={getValue:function(a){return this._isArray?this.a[this.a.length*Math.random()>>0]:this._center?c.MathUtils.randomFloating(this.a,this.b,a):c.MathUtils.randomAToB(this.a,this.b,a)}},c.createSpan=function(a,c,d){if(a instanceof q)return a;return c===b?new q(a):d===b?new q(a,c):new q(a,c,d)},c.Span=q,c.Util.inherits(r,c.Span),r.prototype.getValue=function(){var a=this._arr[this._arr.length*Math.random()>>0];return a=="random"||a=="Random"?c.MathUtils.randomColor():a},c.createArraySpan=function(a){if(!a)return null;return a instanceof c.ArraySpan?a:new c.ArraySpan(a)},c.ArraySpan=r;var s=function(a,c,d,e){this.x=a||0,this.y=c||0,this.z=d||0,this.w=e!==b?e:1};s.prototype={set:function(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d;return this},clone:function(){return new c.Quaternion(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w;return this},setFromEuler:function(a){var b=Math.cos(a.x/2),c=Math.cos(a.y/2),d=Math.cos(a.z/2),e=Math.sin(a.x/2),f=Math.sin(a.y/2),g=Math.sin(a.z/2);this.x=e*c*d+b*f*g,this.y=b*f*d-e*c*g,this.z=b*c*g+e*f*d,this.w=b*c*d-e*f*g;return this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);this.x=a.x*d,this.y=a.y*d,this.z=a.z*d,this.w=Math.cos(c);return this},normalize:function(){var a=this.length();a===0?(this.x=0,this.y=0,this.z=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}},c.Quaternion=s,t.prototype={contains:function(a,b,c){return a<=this.right&&a>=this.x&&b<=this.bottom&&b>=this.y&&c<=this.depth&&c>=this.z?!0:!1}},c.Box=t,u.id=0,u.prototype={reset:function(a,b){this.life=c.Util.initValue(a,Infinity),this.easing=c.Util.initValue(b,c.ease.setEasingByName(c.ease.easeLinear))},normalizeForce:function(a){return a.scalar(c.MEASURE)},normalizeValue:function(a){return a*c.MEASURE},initialize:function(a){},applyBehaviour:function(a,b,c){if(!this.dead){this.age+=b;if(this.age>=this.life){this.energy=0,this.dead=!0;return}var d=this.easing(a.age/a.life);this.energy=Math.max(1-d,0)}},destroy:function(){}},c.Behaviour=u,v.prototype={init:function(){this.startTime=0,this.nextTime=this.timePan.getValue()},getValue:function(a){this.startTime+=a;if(this.startTime>=this.nextTime){this.init();return this.numPan.b==1?this.numPan.getValue("Float")>.5?1:0:this.numPan.getValue("Int")}return 0}},c.Rate=v,w.prototype.reset=function(){},w.prototype.init=function(a,b){b?this.initialize(b):this.initialize(a)},w.prototype.initialize=function(a){},c.Initialize=w;var x={initialize:function(a,b,d){var e=d.length;while(e--){var f=d[e];f instanceof c.Initialize?f.init(a,b):x.init(a,b,f)}x.bindEmitter(a,b)},init:function(a,b,d){c.Util.setPrototypeByObj(b,d),c.Util.setVectorByObj(b,d)},bindEmitter:function(a,b){a.bindEmitter&&(b.p.add(a.p),b.v.add(a.v),b.a.add(a.a),b.v.applyEuler(a.rotation))}};c.InitializeUtil=x,c.Util.inherits(y,c.Initialize),y.prototype.initialize=function(a){this.lifePan.a==Infinity||this.lifePan.a=="infi"?a.life=Infinity:a.life=this.lifePan.getValue()},c.Life=y,c.Util.inherits(z,c.Initialize),z.prototype.reset=function(){this.zones?this.zones.length=0:this.zones=[];var a=Array.prototype.slice.call(arguments);this.zones=this.zones.concat(a)},z.prototype.addZone=function(){var a=Array.prototype.slice.call(arguments);this.zones=this.zones.concat(a)},z.prototype.initialize=function(){var a;return function(a){var b=this.zones[Math.random()*this.zones.length>>0];b.getPosition(),a.p.x=b.vector.x,a.p.y=b.vector.y,a.p.z=b.vector.z}}(),c.Position=z,c.P=z,c.Util.inherits(A,c.Initialize),A.prototype.reset=function(a,b,d){a instanceof c.Vector3D?(this.radiusPan=c.createSpan(1),this.dir=a.clone(),this.tha=b*c.DR,this._useV=!0):a instanceof c.Polar3D?(this.tha=b*c.DR,this.dirVec=a.toVector3D(),this._useV=!1):(this.radiusPan=c.createSpan(a),this.dir=b.clone().normalize(),this.tha=d*c.DR,this._useV=!0)},A.prototype.normalize=function(a){return a*c.MEASURE},A.prototype.initialize=function(){var a,b=new c.Vector3D(0,0,1),d=new c.Vector3D(0,0,0);return function(e){a=this.tha*Math.random(),this._useV&&this.dirVec.copy(this.dir).scalar(this.radiusPan.getValue()),c.MathUtils.getNormal(this.dirVec,b),d.copy(this.dirVec).applyAxisAngle(b,a),d.applyAxisAngle(this.dirVec.normalize(),Math.random()*c.PI*2),e.v.copy(d);return this}}(),c.Velocity=A,c.V=A,c.Util.inherits(B,c.Initialize),B.prototype.initialize=function(a){a.mass=this.massPan.getValue()},c.Mass=B,c.Util.inherits(C,c.Initialize),C.prototype.reset=function(a,b,d){this.radius=c.createSpan(a,b,d)},C.prototype.initialize=function(a){a.radius=this.radius.getValue(),a.transform.oldRadius=a.radius},c.Radius=C,c.Util.inherits(D,c.Initialize),D.prototype.initialize=function(a){var b=this.body.getValue();this.w?a.body={width:this.w,height:this.h,body:b}:a.body=b},c.Body=D,c.Util.inherits(E,c.Behaviour),E.prototype.reset=function(a,b,d){this.force=this.normalizeForce(new c.Vector3D(a,b,d)),this.force.id=Math.random()},E.prototype.applyBehaviour=function(a,b,c){E._super_.prototype.applyBehaviour.call(this,a,b,c),a.a.add(this.force)},c.F=c.Force=E,c.Util.inherits(F,c.Behaviour),F.prototype.reset=function(a,b,d,e,f){this.targetPosition=c.Util.initValue(a,new c.Vector3D),this.radius=c.Util.initValue(d,1e3),this.force=c.Util.initValue(this.normalizeValue(b),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new c.Vector3D,this.lengthSq=0,e&&F._super_.prototype.reset.call(this,e,f)},F.prototype.applyBehaviour=function(a,b,c){F._super_.prototype.applyBehaviour.call(this,a,b,c),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(a.p),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-6&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.scalar(1-this.lengthSq/this.radiusSq),this.attractionForce.scalar(this.force),a.a.add(this.attractionForce))},c.Attraction=F,c.Util.inherits(G,c.Behaviour),G.prototype.reset=function(a,b,d,e,f,g){this.randomFoce=this.normalizeForce(new c.Vector3D(a,b,d)),this.delayPan=c.createSpan(e||.03),this.time=0,f&&G._super_.prototype.reset.call(this,f,g)},G.prototype.applyBehaviour=function(a,b,d){G._super_.prototype.applyBehaviour.call(this,a,b,d),this.time+=b;if(this.time>=this.delayPan.getValue()){var e=c.MathUtils.randomAToB(-this.randomFoce.x,this.randomFoce.x),f=c.MathUtils.randomAToB(-this.randomFoce.y,this.randomFoce.y),g=c.MathUtils.randomAToB(-this.randomFoce.z,this.randomFoce.z);a.a.addValue(e,f,g),this.time=0}},c.RandomDrift=G,c.Util.inherits(H,c.Attraction),H.prototype.reset=function(a,b,c,d,e){H._super_.prototype.reset.call(this,a,b,c,d,e),this.force*=-1},c.Repulsion=H,c.Util.inherits(I,c.Force),I.prototype.reset=function(a,b,c){I._super_.prototype.reset.call(this,0,-a,0,b,c)},c.Gravity=I,c.G=I,c.Util.inherits(J,c.Behaviour),J.prototype.reset=function(a,b,d,e,f){this.emitter=a,this.useMass=b,this.callback=d,this.particles=[],this.delta=new c.Vector3D,e&&J._super_.prototype.reset.call(this,e,f)},J.prototype.applyBehaviour=function(a,b,c){var d=this.emitter?this.emitter.particles.slice(c):this.particles.slice(c),e,f,g,h,i,j,k=d.length;while(k--){e=d[k];if(e==a)continue;this.delta.copy(e.p).sub(a.p),f=this.delta.lengthSq(),h=a.radius+e.radius,f<=h*h&&(g=h-Math.sqrt(f),g+=.5,i=this._getAverageMass(a,e),j=this._getAverageMass(e,a),a.p.add(this.delta.clone().normalize().scalar(g*-i)),e.p.add(this.delta.normalize().scalar(g*j)),this.callback&&this.callback(a,e))}},J.prototype._getAverageMass=function(a,b){return this.useMass?b.mass/(a.mass+b.mass):.5},c.Collision=J,c.Util.inherits(K,c.Behaviour),K.prototype.reset=function(a,b,d,e){var f,g;typeof a=="string"?(g=a,f=b):(g=b,f=a),this.zone=f,this.zone.crossType=c.Util.initValue(g,"dead"),d&&K._super_.prototype.reset.call(this,d,e)},K.prototype.applyBehaviour=function(a,b,c){K._super_.prototype.applyBehaviour.call(this,a,b,c),this.zone.crossing.call(this.zone,a)},c.CrossZone=K,c.Util.inherits(L,c.Behaviour),L.prototype.reset=function(a,d,e,f){d==null||d==b?this._same=!0:this._same=!1,this.a=c.createSpan(c.Util.initValue(a,1)),this.b=c.createSpan(d),e&&L._super_.prototype.reset.call(this,e,f)},L.prototype.initialize=function(a){a.useAlpha=!0,a.transform.alphaA=this.a.getValue(),this._same?a.transform.alphaB=a.transform.alphaA:a.transform.alphaB=this.b.getValue()},L.prototype.applyBehaviour=function(a,b,d){L._super_.prototype.applyBehaviour.call(this,a,b,d),a.alpha=c.MathUtils.lerp(a.transform.alphaA,a.transform.alphaB,this.energy),a.alpha<.002&&(a.alpha=0)},c.Alpha=L,c.Util.inherits(M,c.Behaviour),M.prototype.reset=function(a,d,e,f){d==null||d==b?this._same=!0:this._same=!1,this.a=c.createSpan(c.Util.initValue(a,1)),this.b=c.createSpan(d),e&&M._super_.prototype.reset.call(this,e,f)},M.prototype.initialize=function(a){a.transform.scaleA=this.a.getValue(),a.transform.oldRadius=a.radius,this._same?a.transform.scaleB=a.transform.scaleA:a.transform.scaleB=this.b.getValue()},M.prototype.applyBehaviour=function(a,b,d){M._super_.prototype.applyBehaviour.call(this,a,b,d),a.scale=c.MathUtils.lerp(a.transform.scaleA,a.transform.scaleB,this.energy),a.scale<5e-4&&(a.scale=0),a.radius=a.transform.oldRadius*a.scale},c.Scale=M,c.Util.inherits(N,c.Behaviour),N.prototype.reset=function(a,d,e,f,g){this.a=a||0,this.b=d||0,this.c=e||0,a===b||a=="same"?this._type="same":d==b?this._type="set":e===b?this._type="to":(this._type="add",this.a=c.createSpan(this.a*c.DR),this.b=c.createSpan(this.b*c.DR),this.c=c.createSpan(this.c*c.DR)),f&&N._super_.prototype.reset.call(this,f,g)},N.prototype.initialize=function(a){switch(this._type){case"same":break;case"set":this._setRotation(a.rotation,this.a);break;case"to":a.transform.fR=a.transform.fR||new c.Vector3D,a.transform.tR=a.transform.tR||new c.Vector3D,this._setRotation(a.transform.fR,this.a),this._setRotation(a.transform.tR,this.b);break;case"add":a.transform.addR=new c.Vector3D(this.a.getValue(),this.b.getValue(),this.c.getValue())}},N.prototype._setRotation=function(a,b){a=a||new c.Vector3D;if(b=="random"){var d=c.MathUtils.randomAToB(-c.PI,c.PI),e=c.MathUtils.randomAToB(-c.PI,c.PI),f=c.MathUtils.randomAToB(-c.PI,c.PI);a.set(d,e,f)}else b instanceof c.Vector3D&&a.copy(b)},N.prototype.applyBehaviour=function(a,b,d){N._super_.prototype.applyBehaviour.call(this,a,b,d);switch(this._type){case"same":a.rotation||(a.rotation=new c.Vector3D),a.rotation.eulerFromDir(a.v);break;case"set":break;case"to":a.rotation.x=c.MathUtils.lerp(a.transform.fR.x,a.transform.tR.x,this.energy),a.rotation.y=c.MathUtils.lerp(a.transform.fR.y,a.transform.tR.y,this.energy),a.rotation.z=c.MathUtils.lerp(a.transform.fR.z,a.transform.tR.z,this.energy);break;case"add":a.rotation.add(a.transform.addR)}},c.Rotate=N,c.Util.inherits(O,c.Behaviour),O.prototype.reset=function(a,d,e,f){d==null||d==b?this._same=!0:this._same=!1,this.a=c.createArraySpan(a),this.b=c.createArraySpan(d),e&&O._super_.prototype.reset.call(this,e,f)},O.prototype.initialize=function(a){a.transform.colorA=c.ColorUtil.getRGB(this.a.getValue()),a.useColor=!0,this._same?a.transform.colorB=a.transform.colorA:a.transform.colorB=c.ColorUtil.getRGB(this.b.getValue())},O.prototype.applyBehaviour=function(a,b,d){O._super_.prototype.applyBehaviour.call(this,a,b,d),this._same?(a.color.r=a.transform.colorA.r,a.color.g=a.transform.colorA.g,a.color.b=a.transform.colorA.b):(a.color.r=c.MathUtils.lerp(a.transform.colorA.r,a.transform.colorB.r,this.energy),a.color.g=c.MathUtils.lerp(a.transform.colorA.g,a.transform.colorB.g,this.energy),a.color.b=c.MathUtils.lerp(a.transform.colorA.b,a.transform.colorB.b,this.energy))},c.Color=O,c.Util.inherits(P,c.Behaviour),P.prototype.reset=function(a,b,d,e,f){this.pos?this.pos.set(a,b,d):this.pos=new c.Vector3D(a,b,d),this.spring=e||.1,this.friction=f||.98},P.prototype.applyBehaviour=function(a,b,c){P._super_.prototype.applyBehaviour.call(this,a,b,c),a.v.x+=(this.pos.x-a.p.x)*this.spring,a.v.y+=(this.pos.y-a.p.y)*this.spring,a.v.z+=(this.pos.z-a.p.z)*this.spring},c.Spring=P,Q.ID=0,c.Util.inherits(Q,c.Particle),c.EventDispatcher.initialize(Q.prototype),Q.prototype.emit=function(a,b){this.currentEmitTime=0,this.totalEmitTimes=c.Util.initValue(a,Infinity),b==!0||b=="life"||b=="destroy"?this.life=a=="once"?1:this.totalEmitTimes:isNaN(b)||(this.life=b),this.rate.init()},Q.prototype.stopEmit=function(){this.totalEmitTimes=-1,this.currentEmitTime=0},Q.prototype.removeAllParticles=function(){var a=this.particles.length;while(a--)this.particles[a].dead=!0},Q.prototype.createParticle=function(a,b){var d=this.parent.pool.get(c.Particle);this.setupParticle(d,a,b),this.parent&&this.parent.dispatchEvent("PARTICLE_CREATED",d),c.bindEmtterEvent&&this.dispatchEvent("PARTICLE_CREATED",d);return d},Q.prototype.addSelfInitialize=function(a){a.init?a.init(this):this.initAll()},Q.prototype.addInitialize=function(){var a=arguments.length;while(a--)this.initializes.push(arguments[a])},Q.prototype.removeInitialize=function(a){var b=this.initializes.indexOf(a);b>-1&&this.initializes.splice(b,1)},Q.prototype.removeInitializers=function(){c.Util.destroyArray(this.initializes)},Q.prototype.addBehaviour=function(){var a=arguments.length;while(a--)this.behaviours.push(arguments[a])},Q.prototype.removeBehaviour=function(a){var b=this.behaviours.indexOf(a);b>-1&&this.behaviours.splice(b,1)},Q.prototype.removeAllBehaviours=function(){c.Util.destroyArray(this.behaviours)},Q.prototype.integrate=function(a){var b=1-this.damping;c.integrator.integrate(this,a,b);var d=this.particles.length;while(d--){var e=this.particles[d];e.update(a,d),c.integrator.integrate(e,a,b),this.parent&&this.parent.dispatchEvent("PARTICLE_UPDATE",e),c.bindEmtterEvent&&this.dispatchEvent("PARTICLE_UPDATE",e)}},Q.prototype.emitting=function(a){if(this.totalEmitTimes=="once"){var b=this.rate.getValue(99999);b>0&&(this.cID=b);while(b--)this.createParticle();this.totalEmitTimes="none"}else if(!isNaN(this.totalEmitTimes)){this.currentEmitTime+=a;if(this.currentEmitTime<this.totalEmitTimes){var b=this.rate.getValue(a);b>0&&(this.cID=b);while(b--)this.createParticle()}}},Q.prototype.update=function(a){this.age+=a,(this.dead||this.age>=this.life)&&this.destroy(),this.emitting(a),this.integrate(a);var b,d=this.particles.length;while(d--)b=this.particles[d],b.dead&&(this.parent&&this.parent.dispatchEvent("PARTICLE_DEAD",b),c.bindEmtterEvent&&this.dispatchEvent("PARTICLE_DEAD",b),this.parent.pool.expire(b.reset()),this.particles.splice(d,1))},Q.prototype.setupParticle=function(a,b,d){var e=this.initializes,f=this.behaviours;b&&(c.Util.isArray(b)?e=b:e=[b]),d&&(c.Util.isArray(d)?f=d:f=[d]),c.InitializeUtil.initialize(this,a,e),a.addBehaviours(f),a.parent=this,this.particles.push(a)},Q.prototype.destroy=function(){this.dead=!0,this.energy=0,this.totalEmitTimes=-1,this.particles.length==0&&(this.removeInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this))},c.Emitter=Q,c.Util.inherits(R,c.Emitter),R.prototype.addSelfBehaviour=function(){var a=arguments.length,b;for(b=0;b<a;b++)this.selfBehaviours.push(arguments[b])},R.prototype.removeSelfBehaviour=function(a){var b=this.selfBehaviours.indexOf(a);b>-1&&this.selfBehaviours.splice(b,1)},R.prototype.update=function(a){R._super_.prototype.update.call(this,a);if(!this.sleep){var b=this.selfBehaviours.length,c;for(c=0;c<b;c++)this.selfBehaviours[c].applyBehaviour(this,a,c)}},c.BehaviourEmitter=R,c.Util.inherits(S,c.Emitter),S.prototype.initEventHandler=function(){var a=this;this.mousemoveHandler=function(b){a.mousemove.call(a,b)},this.mousedownHandler=function(b){a.mousedown.call(a,b)},this.mouseupHandler=function(b){a.mouseup.call(a,b)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)},S.prototype.emit=function(){this._allowEmitting=!0},S.prototype.stopEmit=function(){this._allowEmitting=!1},S.prototype.setCameraAndCanvas=function(a,b){this.camera=a,this.canvas=b},S.prototype.mousemove=function(a){if(a.layerX||a.layerX==0)this.p.x+=(a.layerX-this.p.x)*this.ease,this.p.y+=(a.layerY-this.p.y)*this.ease;else if(a.offsetX||a.offsetX==0)this.p.x+=(a.offsetX-this.p.x)*this.ease,this.p.y+=(a.offsetY-this.p.y)*this.ease;this.p.copy(c.THREEUtil.toSpacePos(this.p,this.camera,this.canvas)),this._allowEmitting&&S._super_.prototype.emit.call(this,"once")},S.prototype.destroy=function(){S._super_.prototype.destroy.call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)},c.FollowEmitter=S;var T=T||{easeLinear:function(a){return a},easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){if((a/=.5)<1)return.5*Math.pow(a,2);return-0.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){if((a/=.5)<1)return.5*Math.pow(a,3);return.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-1,4)-1)},easeInOutQuart:function(a){if((a/=.5)<1)return.5*Math.pow(a,4);return-0.5*((a-=2)*Math.pow(a,3)-2)},easeInSine:function(a){return-Math.cos(a*(c.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(c.PI/2))},easeInOutSine:function(a){return-0.5*(Math.cos(c.PI*a)-1)},easeInExpo:function(a){return a===0?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return a===1?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){if(a===0)return 0;if(a===1)return 1;if((a/=.5)<1)return.5*Math.pow(2,10*(a-1));return.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){if((a/=.5)<1)return-0.5*(Math.sqrt(1-a*a)-1);return.5*(Math.sqrt(1-(a-=2)*a)+1)},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a=a-1)*a*((b+1)*a+b)+1},easeInOutBack:function(a){var b=1.70158;if((a/=.5)<1)return.5*a*a*(((b*=1.525)+1)*a-b);return.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},setEasingByName:function(a){return T[a]?T[a]:T.easeLinear}};for(var U in T)U!="setEasingByName"&&(c[U]=T[U]);c.ease=T,V.prototype={init:function(a){var b=this;this.proton=a,this.proton.addEventListener("PROTON_UPDATE",function(a){b.onProtonUpdate.call(b,a)}),this.proton.addEventListener("PARTICLE_CREATED",function(a){b.onParticleCreated.call(b,a)}),this.proton.addEventListener("PARTICLE_UPDATE",function(a){b.onParticleUpdate.call(b,a)}),this.proton.addEventListener("PARTICLE_DEAD",function(a){b.onParticleDead.call(b,a)})},remove:function(a){this.proton=null},onParticleCreated:function(a){},onParticleUpdate:function(a){},onParticleDead:function(a){},onProtonUpdate:function(a){}},c.BaseRender=V,c.Util.inherits(W,c.BaseRender),W.prototype.onProtonUpdate=function(){},W.prototype.onParticleCreated=function(a){if(!a.target){a.body||(a.body=this._body),a.target=this._targetPool.get(a.body);if(a.useAlpha||a.useColor)a.target.material.__puid=c.PUID.id(a.body.material),a.target.material=this._materialPool.get(a.target.material)}a.target&&(a.target.position.copy(a.p),this.container.add(a.target))},W.prototype.onParticleUpdate=function(a){a.target&&(a.target.position.copy(a.p),a.target.rotation.set(a.rotation.x,a.rotation.y,a.rotation.z),this.scale(a),a.useAlpha&&(a.target.material.opacity=a.alpha,a.target.material.transparent=!0),a.useColor&&a.target.material.color.copy(a.color))},W.prototype.scale=function(a){a.target.scale.set(a.scale,a.scale,a.scale)},W.prototype.onParticleDead=function(a){a.target&&((a.useAlpha||a.useColor)&&this._materialPool.expire(a.target.material),this._targetPool.expire(a.target),this.container.remove(a.target),a.target=null)},c.MeshRender=W,c.Util.inherits(X,c.BaseRender),X.prototype.onProtonUpdate=function(){},X.prototype.onParticleCreated=function(a){a.target||(a.target=new THREE.Vector3),a.target.copy(a.p),this.points.geometry.vertices.push(a.target)},X.prototype.onParticleUpdate=function(a){a.target&&a.target.copy(a.p)},X.prototype.onParticleDead=function(a){if(a.target){var b=this.points.geometry.vertices.indexOf(a.target);b>-1&&this.points.geometry.vertices.splice(b,1),a.target=null}},c.PointsRender=X,c.Util.inherits(Y,c.MeshRender),Y.prototype.scale=function(a){a.target.scale.set(a.scale*a.radius,a.scale*a.radius,1)},c.SpriteRender=Y,c.Util.inherits(Z,c.BaseRender),Z.prototype.onProtonUpdate=function(){},Z.prototype.onParticleCreated=function(a){},Z.prototype.onParticleUpdate=function(a){},Z.prototype.onParticleDead=function(a){},c.CustomRender=Z,$.prototype={getPosition:function(){return null},crossing:function(a){switch(this.crossType){case"bound":this._bound(a);break;case"cross":this._cross(a);break;case"dead":this._dead(a)}},_dead:function(a){},_bound:function(a){},_cross:function(a){}},c.Zone=$,c.Util.inherits(_,c.Zone),_.prototype.getPosition=function(){this.random=Math.random(),this.vector.x=this.x1+this.random*(this.x2-this.x1),this.vector.y=this.y1+this.random*(this.y2-this.y1),this.vector.z=this.z1+this.random*(this.z2-this.z1);return this.vector},_.prototype.crossing=function(a){this.log&&(console.error("Sorry LineZone does not support crossing method"),this.log=!1)},c.LineZone=_,c.Util.inherits(ba,c.Zone),ba.prototype.getPosition=function(){var a,b,d;return function(){this.random=Math.random(),d=this.random*this.radius,tha=c.PI*Math.random(),b=c.PI*2*Math.random(),this.vector.x=this.x+d*Math.sin(tha)*Math.cos(b),this.vector.y=this.y+d*Math.sin(b)*Math.sin(tha),this.vector.z=this.z+d*Math.cos(tha);return this.vector}}(),ba.prototype._dead=function(a){var b=a.p.distanceTo(this);b-a.radius>this.radius&&(a.dead=!0)},ba.prototype._bound=function(){var a=new c.Vector3D,b=new c.Vector3D,d;return function(c){var e=c.p.distanceTo(this);e+c.radius>=this.radius&&(a.copy(c.p).sub(this).normalize(),b.copy(c.v),d=2*b.dot(a),c.v.sub(a.scalar(d)))}}(),ba.prototype._cross=function(a){this.log&&(console.error("Sorry SphereZone does not support _cross method"),this.log=!1)},c.SphereZone=ba,c.Util.inherits(bb,c.Zone),bb.prototype.getPosition=function(){var a=this.geometry.vertices,b=a[a.length*Math.random()>>0];this.vector.x=b.x*this.scale,this.vector.y=b.y*this.scale,this.vector.z=b.z*this.scale;return this.vector},bb.prototype.crossing=function(a){this.log&&(console.error("Sorry MeshZone does not support crossing method"),this.log=!1)},c.MeshZone=bb,c.Util.inherits(bc,c.Zone),bc.prototype.getPosition=function(){this.vector.x=this.x,this.vector.y=this.y,this.vector.z=this.z;return this.vector},bc.prototype.crossing=function(a){this.log&&(console.error("Sorry PointZone does not support crossing method"),this.log=!1)},c.PointZone=bc,c.Util.inherits(bd,c.Zone),bd.prototype.getPosition=function(){this.vector.x=this.x+c.MathUtils.randomAToB(-0.5,.5)*this.width,this.vector.y=this.y+c.MathUtils.randomAToB(-0.5,.5)*this.height,this.vector.z=this.z+c.MathUtils.randomAToB(-0.5,.5)*this.depth;return this.vector},bd.prototype._dead=function(a){a.p.x+a.radius<this.x-this.width/2?a.dead=!0:a.p.x-a.radius>this.x+this.width/2&&(a.dead=!0),a.p.y+a.radius<this.y-this.height/2?a.dead=!0:a.p.y-a.radius>this.y+this.height/2&&(a.dead=!0),a.p.z+a.radius<this.z-this.depth/2?a.dead=!0:a.p.z-a.radius>this.z+this.depth/2&&(a.dead=!0)},bd.prototype._bound=function(a){a.p.x-a.radius<this.x-this.width/2?(a.p.x=this.x-this.width/2+a.radius,a.v.x*=-this.friction,this._static(a,"x")):a.p.x+a.radius>this.x+this.width/2&&(a.p.x=this.x+this.width/2-a.radius,a.v.x*=-this.friction,this._static(a,"x")),a.p.y-a.radius<this.y-this.height/2?(a.p.y=this.y-this.height/2+a.radius,a.v.y*=-this.friction,this._static(a,"y")):a.p.y+a.radius>this.y+this.height/2&&(a.p.y=this.y+this.height/2-a.radius,a.v.y*=-this.friction,this._static(a,"y")),a.p.z-a.radius<this.z-this.depth/2?(a.p.z=this.z-this.depth/2+a.radius,a.v.z*=-this.friction,this._static(a,"z")):a.p.z+a.radius>this.z+this.depth/2&&(a.p.z=this.z+this.depth/2-a.radius,a.v.z*=-this.friction,this._static(a,"z"))},bd.prototype._static=function(a,b){a.v[b]*a.a[b]>0||Math.abs(a.v[b])<Math.abs(a.a[b])*.0167*this.max&&(a.v[b]=0,a.a[b]=0)},bd.prototype._cross=function(a){a.p.x+a.radius<this.x-this.width/2&&a.v.x<=0?a.p.x=this.x+this.width/2+a.radius:a.p.x-a.radius>this.x+this.width/2&&a.v.x>=0&&(a.p.x=this.x-this.width/2-a.radius),a.p.y+a.radius<this.y-this.height/2&&a.v.y<=0?a.p.y=this.y+this.height/2+a.radius:a.p.y-a.radius>this.y+this.height/2&&a.v.y>=0&&(a.p.y=this.y-this.height/2-a.radius),a.p.z+a.radius<this.z-this.depth/2&&a.v.z<=0?a.p.z=this.z+this.depth/2+a.radius:a.p.z-a.radius>this.z+this.depth/2&&a.v.z>=0&&(a.p.z=this.z-this.depth/2-a.radius)},c.BoxZone=bd,c.Util.inherits(be,c.Zone),be.prototype.getPosition=function(){var a=new c.Vector3D,b;return function(){b=this.renderer.domElement,a.x=Math.random()*b.width,a.y=Math.random()*b.height,this.vector.copy(c.THREEUtil.toSpacePos(a,this.camera,b));return this.vector}}(),be.prototype._dead=function(a){var b=c.THREEUtil.toScreenPos(a.p,this.camera,this.renderer.domElement),d=this.renderer.domElement;b.y+a.radius<-this.dis&&this.d1?a.dead=!0:b.y-a.radius>d.height+this.dis&&this.d3&&(a.dead=!0),b.x+a.radius<-this.dis&&this.d4?a.dead=!0:b.x-a.radius>d.width+this.dis&&this.d2&&(a.dead=!0)},be.prototype._cross=function(){var a=new c.Vector3D;return function(b){var d=c.THREEUtil.toScreenPos(b.p,this.camera,this.renderer.domElement),e=this.renderer.domElement;d.y+b.radius<-this.dis?(a.x=d.x,a.y=e.height+this.dis+b.radius,b.p.y=c.THREEUtil.toSpacePos(a,this.camera,e).y):d.y-b.radius>e.height+this.dis&&(a.x=d.x,a.y=-this.dis-b.radius,b.p.y=c.THREEUtil.toSpacePos(a,this.camera,e).y),d.x+b.radius<-this.dis?(a.y=d.y,a.x=e.width+this.dis+b.radius,b.p.x=c.THREEUtil.toSpacePos(a,this.camera,e).x):d.x-b.radius>e.width+this.dis&&(a.y=d.y,a.x=-this.dis-b.radius,b.p.x=c.THREEUtil.toSpacePos(a,this.camera,e).x)}}(),be.prototype._bound=function(a){var b=c.THREEUtil.toScreenPos(a.p,this.camera,this.renderer.domElement),d=this.renderer.domElement;b.y+a.radius<-this.dis?a.v.y*=-1:b.y-a.radius>d.height+this.dis&&(a.v.y*=-1),b.x+a.radius<-this.dis?a.v.y*=-1:b.x-a.radius>d.width+this.dis&&(a.v.y*=-1)},c.ScreenZone=be;var bf=function(){if(a.console&&a.console.trace){var b=Array.prototype.slice.call(arguments),c=arguments[0]+"";if(c.indexOf("+")==0){var d=parseInt(arguments[0]);bf.once<d&&(b.shift(),console.trace.apply(console,b),bf.once++)}else b.unshift("+15"),bf.apply(console,b)}};bf.once=0,c.log=bf;var bg=bg||{addEventListener:function(a,b){a.addEventListener("PROTON_UPDATE",function(a){b(a)})},drawZone:function(a,b,d){var e,f,g;d instanceof c.PointZone?e=new THREE.SphereGeometry(15):d instanceof c.LineZone||(d instanceof c.BoxZone?e=new THREE.BoxGeometry(d.width,d.height,d.depth):d instanceof c.SphereZone?e=new THREE.SphereGeometry(d.radius,10,10):d instanceof c.MeshZone&&(d.geometry instanceof THREE.Geometry?e=d.geometry:e=d.geometry.geometry,e=new THREE.SphereGeometry(d.radius,10,10))),f=new THREE.MeshBasicMaterial({color:"#2194ce",wireframe:!0}),g=new THREE.Mesh(e,f),b.add(g),this.addEventListener(a,function(a){g.position.set(d.x,d.y,d.z)})},drawEmitter:function(a,b,c,d){var e=new THREE.OctahedronGeometry(15),f=new THREE.MeshBasicMaterial({color:d||"#aaa",wireframe:!0}),g=new THREE.Mesh(e,f);b.add(g),this.addEventListener(a,function(){g.position.copy(c.p),g.rotation.set(c.rotation.x,c.rotation.y,c.rotation.z)})},renderInfo:function(){function b(a){var b=a.emitters[0];return Math.round(b.p.x)+","+Math.round(b.p.y)+","+Math.round(b.p.z)}function a(a){var b=a=="material"?"_materialPool":"_targetPool",c=proton.renderers[0];return c[b].cID}return function(c,d){this.addInfo(d);var e="";switch(this._infoType){case 2:e+="emitter:"+c.emitters.length+"<br>",e+="em speed:"+c.emitters[0].cID+"<br>",e+="pos:"+b(c);break;case 3:e+=c.renderers[0].name+"<br>",e+="target:"+a("target")+"<br>",e+="material:"+a("material");break;default:e+="particles:"+c.getCount()+"<br>",e+="pool:"+c.pool.getCount()+"<br>",e+="total:"+(c.getCount()+c.pool.getCount())}this._infoCon.innerHTML=e}}(),addInfo:function(){return function(a){var b=this;if(!this._infoCon){this._infoCon=document.createElement("div"),this._infoCon.style.cssText=["position:fixed;bottom:0px;left:0;cursor:pointer;","opacity:0.9;z-index:10000;padding:10px;font-size:12px;","width:120px;height:50px;background-color:#002;color:#0ff;"].join(""),this._infoType=1,this._infoCon.addEventListener("click",function(a){b._infoType++,b._infoType>3&&(b._infoType=1)},!1);var c,d;switch(a){case 2:c="#201",d="#f08";break;case 3:c="#020",d="#0f0";break;default:c="#002",d="#0ff"}this._infoCon.style["background-color"]=c,this._infoCon.style.color=d}this._infoCon.parentNode||document.body.appendChild(this._infoCon)}}()};c.Debug=bg})(window)